# アーキテクチャドキュメント

## 目次

このディレクトリには、`battle_for_the_cats`プロジェクトのアーキテクチャに関する包括的なドキュメントが含まれています。

---

## 📚 ドキュメント一覧

### 1. [アーキテクチャ概要](./01_overview.md)
プロジェクト全体の5層アーキテクチャ構成と、各層の責務を説明します。

**内容**:
- 5層アーキテクチャ構成図
- 各層の責務と構成要素
- データフロー（読み取り・書き込み）
- 採用デザインパターン一覧
- リアルタイム同期の仕組み
- アーキテクチャの利点

**対象読者**: プロジェクト全体を理解したい人

---

### 2. [HomeScreen MVVM構造](./02_mvvm_home.md)
ホーム画面（メインメニュー、マッチング）のMVVM実装を詳細に解説します。

**内容**:
- MVVM構成図
- State Pattern（3状態）
- ViewModelの主要メソッド
  - 部屋作成
  - ランダムマッチング
  - 部屋参加
  - マッチングキャンセル
- View層の実装
- データフロー例
- エラーハンドリング
- メモリ管理

**対象読者**: ホーム画面の実装を理解したい人

---

### 3. [GameScreen MVVM構造](./03_mvvm_game.md)
ゲーム画面のMVVM実装と、リアルタイム同期の仕組みを詳細に解説します。

**内容**:
- MVVM構成図
- State Pattern（6状態）
- **リアルタイム同期の仕組み**（最重要）
  - Stream監視の初期化
  - UI状態の判定ロジック
  - ターン変更時のリセット
- ViewModelの主要メソッド
  - サイコロを振る
  - ベット更新
  - ベット確定
  - 次のターンへ
- ゲームプレイフロー（1ターン全体）
- ローカル状態管理
- PlayerDataヘルパークラス

**対象読者**: ゲーム画面の実装を理解したい人、リアルタイム同期の仕組みを知りたい人

---

### 4. [クラス関係図](./04_class_diagram.md)
プロジェクト内の主要クラス間の関係を図示します。

**内容**:
- 全体クラス関係図（UML）
- Service層の依存関係
- Repository層の継承関係
- Domain層のクラス
- State Patternの実装
- ViewModel - Service - Repository の詳細フロー
- 依存性注入の流れ

**対象読者**: クラス間の関係性を理解したい人、設計パターンを学びたい人

---

### 5. [データフロー詳細](./05_data_flow.md)
主要なシナリオごとのデータフローをシーケンス図で解説します。

**内容**:
- 部屋作成フロー
- ランダムマッチングフロー
  - マッチング参加
  - マッチング成立
- 部屋参加フロー
- **ゲームプレイフロー（1ターン）**
  - サイコロフェーズ
  - ベットフェーズ
  - ラウンド結果 → 次のターン
- リアルタイム同期の詳細
- エラーハンドリングフロー
- メモリ管理フロー
- 依存性注入フロー

**対象読者**: 処理の流れを時系列で理解したい人、実装の詳細を知りたい人

---

### 6. [ファイル構成](./06_file_structure.md)
プロジェクトのファイル・ディレクトリ構造を詳細に説明します。

**内容**:
- プロジェクト全体構造
- lib/ディレクトリ詳細（完全なファイルツリー）
- 層別ファイル分類
- ファイルサイズ統計
- ディレクトリ構造の設計原則
- Import パス規則
- ファイル命名規則
- 今後の拡張時の配置例

**対象読者**: ファイルの配置場所を知りたい人、新規ファイル追加時の参考にしたい人

---

## 🎯 読む順序の推奨

### 初めてこのプロジェクトに触れる人

1. **[01_overview.md](./01_overview.md)** - まず全体像を把握
2. **[06_file_structure.md](./06_file_structure.md)** - ファイルがどこにあるか確認
3. **[02_mvvm_home.md](./02_mvvm_home.md)** - シンプルな画面から理解
4. **[03_mvvm_game.md](./03_mvvm_game.md)** - 複雑な画面とリアルタイム同期
5. **[04_class_diagram.md](./04_class_diagram.md)** - クラス関係を整理
6. **[05_data_flow.md](./05_data_flow.md)** - 処理の流れを確認

---

### 特定の機能を実装・修正したい人

| やりたいこと | 参照ドキュメント |
|------------|----------------|
| 新しい画面を追加 | 02, 03, 06 |
| 新しいServiceを追加 | 01, 04, 05 |
| ゲームルールを変更 | 01 (Domain層), 04, 05 |
| リアルタイム同期を理解 | 03, 05 |
| テストを書く | 01, 04, 06 |
| エラーハンドリングを改善 | 02, 03, 05 |

---

### アーキテクチャを深く理解したい人

1. **[01_overview.md](./01_overview.md)** - 設計思想を理解
2. **[04_class_diagram.md](./04_class_diagram.md)** - 依存関係を確認
3. **[05_data_flow.md](./05_data_flow.md)** - 実際の動作を追跡
4. **[03_mvvm_game.md](./03_mvvm_game.md)** - リアルタイム同期の詳細
5. コードを読む（実装を確認）

---

## 🔍 各ドキュメントの特徴

| ドキュメント | 図の種類 | 詳細度 | 読みやすさ |
|------------|---------|-------|-----------|
| 01_overview.md | フローチャート、シーケンス図 | 中 | ⭐⭐⭐⭐⭐ |
| 02_mvvm_home.md | フローチャート、状態図 | 高 | ⭐⭐⭐⭐ |
| 03_mvvm_game.md | フローチャート、状態図、シーケンス図 | 最高 | ⭐⭐⭐ |
| 04_class_diagram.md | UMLクラス図、依存関係図 | 高 | ⭐⭐⭐ |
| 05_data_flow.md | シーケンス図 | 最高 | ⭐⭐⭐⭐ |
| 06_file_structure.md | ツリー構造 | 高 | ⭐⭐⭐⭐⭐ |

---

## 📖 Mermaid図の表示方法

これらのドキュメントはMermaid記法で図を記述しています。

### VS Codeで表示

1. **Markdown Preview Mermaid Support**拡張機能をインストール
2. `Ctrl+Shift+V`でMarkdownプレビュー表示

### GitHubで表示

- GitHub上で`.md`ファイルを開くと、Mermaid図が自動的にレンダリングされます

### その他の方法

- [Mermaid Live Editor](https://mermaid.live/) でコードを貼り付けて確認

---

## 🏗️ アーキテクチャの特徴

### Clean Architecture 5層構成

```
Presentation Layer (UI)
    ↓
Service Layer (ビジネスロジック調整)
    ↓
Domain Layer (純粋なビジネスロジック)
    ↓
Repository Layer (データアクセス抽象化)
    ↓
Data Layer (Firestore)
```

### 採用パターン

- **MVVM**: Viewとロジックを分離
- **State Pattern**: 型安全な状態管理
- **Facade Pattern**: 統一インターフェース（GameService）
- **Repository Pattern**: データアクセス抽象化
- **Dependency Injection**: テスタビリティ向上
- **Observer Pattern**: リアルタイム同期（Provider + Stream）

### 主要技術

- Flutter SDK: Dart 3.10.1
- Firebase: Cloud Firestore 6.1.1
- Provider: 6.1.1

---

## 🔗 関連リンク

- [Flutter公式ドキュメント](https://flutter.dev/docs)
- [Provider パッケージ](https://pub.dev/packages/provider)
- [Cloud Firestore ドキュメント](https://firebase.google.com/docs/firestore)
- [Mermaid ドキュメント](https://mermaid.js.org/)

---

## 📝 ドキュメント更新ポリシー

- アーキテクチャの変更時は必ず対応するドキュメントを更新する
- 新しい画面・Service追加時は対応するセクションを追記する
- 図は実装と乖離しないよう定期的に見直す

---

## 💡 質問・フィードバック

ドキュメントに関する質問や改善提案があれば、Issueを作成してください。

---

**作成日**: 2026年1月7日  
**最終更新**: 2026年2月17日
